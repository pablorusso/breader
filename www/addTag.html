<html>
	<head>
		<title>Agregar categoria</title>
		<link href="styles/style_addTag.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="scripts/xml.js"></script>
		<script type="text/javascript" src="scripts/show_data.js"></script>

		<script type="text/javascript">
			function toggleLoading( divLoading, divBody )
			{
				if ( divLoading.style.display == "block" )
				{
					divLoading.style.display = "none";
					if ( divBody != null ) divBody.style.display = "block";
				}
				else
				{
					if ( divBody != null ) divBody.style.display = "none";
					divLoading.style.display = "block";
				}
			}


			function addTagHandler( result )
			{
				result = checkError( opener.document, result );
				if ( result == null )
				{
					this.close();
					return;
				}

				var idToFind = getNodeAttr( result.documentElement.childNodes[1], 'id' );
				if ( idToFind == null )
				{
					showDiv( document, 'error_tag', "Agregar categoria - El nodo no tiene id" );
					return;
				}
				var nodeFound = findNodeById( opener.bodyDocument.documentElement.childNodes[1], idToFind );
				opener.bodyDocument.documentElement..childNodes[1].replaceChild( result.documentElement.childNodes[1], nodeFound );
				opener.location.reload();

				hideDiv( document, 'tag_loading', null );
				showDiv( document, 'tag_list', null );

				//this.close();
			}

			function createTagHandler( result )
			{
				opener.doAction ( "?actionCode=T4", opener.tagsHandler, 'T' );
				reload();
			}
			function tagsHandler( result )
			{
				var divTags = document.getElementById('tag_list');
				applyXSLT( 'add_tags.xslt', divTags, result );
				hideDiv( opener.document, 'processing_div', null );
			}

			function doAction( params, handler )
			{
				opener.doAction( params, handler, null );
			}

			function reload()
			{
				doAction( "?actionCode=T4", tagsHandler );
			}

			function newTag()
			{
				var name = prompt( 'Ingrese el nombre de la categoria', '' );
				if ( name == "" )
				{
					alert( "El nombre no puede ser vacio" );
					return;
				}
				doAction ( "?actionCode=" + escape( "T1" ) + "&params=" + escape( "tagName||#" + name ), createTagHandler );
			}

			function addTag( tagId )
			{
				showDiv( document, 'tag_loading', null );
				hideDiv( document, 'tag_list', null );
				doAction ( "?actionCode=" + escape( "A1" ) + "&params=" + escape( "tagId||#" + tagId + "|||artId||#" + opener.document.getElementById( 'artId' ).value ), addTagHandler );
			}
		</script>
	</head>

	<body onLoad="reload()">
		<div id="tag_list" class="catList"></div>
		<div id="tag_loading" class="catList" align="center" style="display:none">Asignando categoria, aguarde...</div>
	</body>
</html>
